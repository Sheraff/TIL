---
layout: post
title:  So many closures
tags:   ['JavaScript', 'Design Pattern', 'Closures', 'Good practices']
---

**TL;DR** When only a small portion of your function needs to change, try to encapsulate one level of abstraction above.

``` javascript
const getNavTo = index => () => {
    navigateTo(index)
}
document.querySelectorAll('.tab').forEach(($el, index) => {
    $el.addEventListener('click', getNavTo(index))
})
```

<hr>

Closures are a pattern that allows you to:
- create a scope in which values are retained
- build a function based on arguments

```javascript
function closure (...scopeArgs) {
    // here you can initialize everything you'll need 
    // for the returned function to work
    ...
    return function (...funcArgs) {
        ...
    }
}
```

Let's see what can be done where:
```javascript
function closure (verb) {
    const prefix = 'Simon says'
    return adjective => `${prefix} ${verb} ${adjective}`
}
const jump = closure('jump')
const run = closure('run')

jump('higher') // Simon says jump higher
run('faster') // Simon says run faster
```
Here you can see that `verb` remains accessible in the returned function, and that the `prefix` we defined internally is also available in the function's scope. We just built a function from parameters and created a scope.

In practice, there are many use cases for closures: initialize a context, factory functions, currying...

**Example 1**: Easily generate a series of similar functions. 
``` javascript
const toggle = (flag) => () => {
        state.open = flag
    }
}

const open = toggle(true)
const close = toggle(false)

open()  // state.open === true
close() // state.open === false
```

**Example 2**: Set up what will be needed for returned function to work.

Expanding on the same example, we want to make sure that any element we will toggle open or closed does have a `state` object to be toggled.
```javascript
const toggle = ($el, flag) => {
    $el.state = Object.assign({}, $el.state, {open: false})
    return () => {
        $el.state.open = flag
    }
}

const open = toggle($element, true)
const close = toggle($element, false)

open()  // $element.state.open === true
close() // $element.state.open === false
```

*Related*: if `Object.assign()` feels a bit obscure to you, I wrote a post about it!



